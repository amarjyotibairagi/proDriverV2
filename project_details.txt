PROJECT DETAILS

1. PROJECT PURPOSE
------------------
The "Pro Driver" platform is a comprehensive Learning Management System (LMS) designed for driver training and certification. It facilitates a dual-role ecosystem:

- **For Drivers (End Users)**: A simplified, mobile-first portal to access assigned training modules, take tests, track progress, and view certifications.
- **For Administrators**: A robust dashboard to manage the workforce, create complex multimedia training content, assign modules to specific groups, and track compliance via reports.

2. PROJECT STRUCTURE
--------------------
The project follows a modern Next.js 16 (App Router) architecture.

Root
├── app/                  # Application Routes & Logic
│   ├── (user)/           # User-facing routes (grouped layout)
│   ├── admin/            # Admin-facing routes
│   ├── api/              # API Route Handlers (REST endpoints)
│   └── actions/          # Server Actions (Backend logic called from Client)
├── components/           # React Components
│   ├── admin-dashboard/  # Admin-specific UI
│   ├── user-dashboard/   # User-specific UI
│   └── ui/               # Shared Reusable Components
├── lib/                  # Utilities (DB connection, helpers)
├── prisma/               # Database Schema & Seeders
└── public/               # Static Assets

3. DETAILED COMPONENT BREAKDOWN
-------------------------------

### A. USER DASHBOARD
**Location**: `app/(user)/dashboard`

**Appearance**:
- **Header**: Minimalist design featuring the company logo, a "Welcome [User]" greeting, and a Logout button.
- **Stats Bar**: A horizontal strip showing key metrics: "Modules Completed", "Average Score", and "Pending Assignments".
- **Main Grid**: A responsive grid layout of **Module Cards**. Each card displays the module thumbnail, title, status badge (Not Started/Ongoing/Completed), and a progress bar.

**Functionality**:
- **Filtering**: Tabbed interface to toggle between "All", "Ongoing", and "Completed" modules.
- **Quick Start**: Clicking a card instantly launches the Module Player in the appropriate mode (Training vs Test).
- **Progress Tracking**: Real-time updates of completion percentage.
- **Language Persistance**: Checks the user's preferred language cookie and applies it to the UI.

### B. MODULE PLAYER (THE LEARNING INTERFACE)
**Location**: `app/(user)/play/[moduleId]`

**Appearance**:
- **Strict 9:16 AR**: The player container is strictly locked to a portrait aspect ratio (mobile phone shape) to ensure learning consistency across all devices. On desktop, it is centered on a dark background.
- **Header**: Displays Module Title, Mode (Training/Test), Language Selector, and Settings (Audio) toggle.
- **Content Area**: A scrollable central region that renders multimedia slides (Images, Text, Icons, Quizzes).
- **Footer**: Simplified navigation controls (Previous/Next) and a thin progress bar at the very bottom.

**Functionality**:
- **Multimedia Rendering**: Dynamically renders slides defined in the JSON structure. Supports:
    - **Images**: Auto-scaled to fit width.
    - **Text**: "Smart Scaled" - font size adjusts based on text length to prevent excessive scrolling.
    - **Audio**: Plays voiceovers tied to specific slides from R2 storage.
- **Audio Mixer**: A popup allows users to independently adjust Voice volume and Background Ambience volume.
- **Quiz Engine**: Blocks progress until the correct answer is selected (in Training mode) or records the answer (in Test mode).
- **Unified Text Scaling**: Groups consecutive text blocks to ensure they share the same font size for visual consistency.
- **RTL Support**: Aggressively overrides alignment to "Right" for Arabic/Urdu languages.

### C. ADMIN DASHBOARD
**Location**: `app/admin/*`

**Appearance**:
- **Sidebar**: A vertical, collapsible sidebar on the left providing navigation to all admin modules (Users, Modules, Audit, Reports).
- **Metric Cards**: The home view displays high-level stats (Total Users, Compliance %, Active Modules).
- **Data Tables**: Used extensively (Users, Master Data) with capabilities for Sorting, Filtering, and Pagination.

**Functionality**:
- **User Management**: Add/Edit/Delete users. "Shadow Login" allowing admins to log in as any user for debugging.
- **Assignments**: A powerful "Dispatcher" interface to select specific users (filtered by Depot/Role) and assign them training modules with due dates.
- **Master Data Control**: CRUD interfaces for efficiently managing Departments, Designations, and Locations without touching the DB.

### D. MODULE MAKER (CONTENT CREATOR)
**Location**: `app/admin/modules/provision`

This is the most complex component of the system.

**Appearance:**
- **Tri-Pane Layout**:
    1.  **Slide Manager (Left)**: A vertical filmstrip of slides. Drag-and-drop to reorder. Buttons to Add/Duplicate/Delete slides.
    2.  **Canvas (Center)**: A WYSIWYG preview of the current slide. It simulates the mobile 9:16 viewport.
    3.  **Properties Panel (Right)**: Context-aware controls based on the selected element (Video/Image/Text/Quiz).

**Functionality:**
- **Element Management**: Add Text, Images, Icons, or Quizzes to a slide. Drag to reorder elements vertically.
- **Asset Integration**:
    - **Image Uploader**: Uploads directly to Cloudflare R2 under structured paths.
    - **Audio Generator**: (Placeholder) triggers for AI voice generation.
- **Translation Manager**: A dedicated view to "Export" source text to a JS file, allowing external translation, and "Import" it back. The system maps translations to Element IDs.
- **Quiz Builder**: UI to define questions, add options, mark correct answers, and set "Try Again" logic.
- **Logic Handling**: Set Module Pass Marks, Time Limits, and "Linked Modules" (Prerequisites).

4. PROJECT STACK
----------------
- **Framework**: Next.js 16.0.10 (App Router)
- **Language**: TypeScript
- **Database**: PostgreSQL
- **ORM**: Prisma Client
- **Storage**: Cloudflare R2
- **Styling**: Tailwind CSS v4
- **State/Forms**: React Hook Form, Zod, Server Actions

5. DB SCHEMA SUMMARY
--------------------
- **users**: Accounts, Roles, Metadata.
- **modules**: Content & Settings.
- **training_assignments**: Progress & Scores.
- **departments/designations/locations**: Master Data.
- **audit_logs**: Security tracking.

6. API & SERVER ACTIONS
-----------------------
Almost all data fetching and mutation is handled via **Server Actions** in `app/actions/`:
- `auth.ts`: Session management.
- `module-editor.ts`: The complex logic for saving nested JSON content and signing R2 upload URLs.
- `assignments.ts`: Batch processing user assignments.
- `reports.ts`: Aggregating complex SQL queries for analytics.

7. KEY FEATURES
---------------
- **R2 Storage Engine**: Custom logic to manage file collisions and rename folders on the fly.
- **Smart Text**: Algorithms that calculate optimal font sizes to reduce scroll fatigue on mobile.
- **Strict RTL**: Specialized rendering logic for Arabic support.
- **Auditable**: Every admin action is logged.
